# Основы сетевых протоколов

## **Модель OSI (Open Systems Interconnection)**

Модель OSI разделяет процесс коммуникации на семь уровней, каждый из которых выполняет уникальные функции:
- **Физический уровень (1-й уровень):** Определяет физические характеристики сети, включая кабели, карты и другое оборудование.
- **Канальный уровень (2-й уровень):** Управляет способом, которым данные передаются по физической сети, включая фрейминг, адресацию и контроль ошибок.
- **Сетевой уровень (3-й уровень):** Отвечает за маршрутизацию пакетов данных в сети.
- **Транспортный уровень (4-й уровень):** Обеспечивает надежную или ненадежную доставку данных и контроль за потоком информации.
- **Сеансовый уровень (5-й уровень):** Управляет сессиями связи между приложениями.
        
Например, проверяя, сохраняется ли сессия пользователя при веб-тестировании.

**Пример кода на Python для тестирования сессии:**
```python
import requests

# Создание сессии
session = requests.Session()

# Аутентификация пользователя
session.post('https://example.com/login', data={'username': 'user', 'password': 'pass'})

# Доступ к странице, требующей аутентификации
response = session.get('https://example.com/dashboard')

# Проверка статуса ответа
assert response.status_code == 200
```
- **Уровень представления (6-й уровень):** Обрабатывает форматирование данных и шифрование.

**Пример кода на Python для тестирования шифрования:**
```python
from cryptography.fernet import Fernet

# Генерация ключа шифрования
key = Fernet.generate_key()
cipher_suite = Fernet(key)

# Шифрование данных
data = "Секретное сообщение".encode()
encrypted_data = cipher_suite.encrypt(data)

# Расшифровка данных
decrypted_data = cipher_suite.decrypt(encrypted_data)
assert decrypted_data.decode() == "Секретное сообщение"
```

- **Прикладной уровень (7-й уровень):** Предоставляет сетевые сервисы конечным пользователям.

**Пример кода на Python для тестирования HTTP API:**
```python
import requests

# Отправка GET запроса
response = requests.get('https://api.example.com/data')

# Проверка статуса ответа и содержимого
assert response.status_code == 200
assert 'data' in response.json()
```

##  **Протоколы TCP и UDP:**

- **TCP (Transmission Control Protocol):** Это протокол ориентированный на соединение, который обеспечивает надежную доставку данных, подтверждение получения и контроль за потоком информации.

__TCP__ — это надежный, ориентированный на соединение протокол. Он гарантирует доставку данных от отправителя к получателю. TCP обеспечивает контроль за передачей данных, подтверждение получения пакетов, повторную отправку потерянных пакетов и упорядочивание данных.

**Основные характеристики TCP:**
- **Надежность:** TCP обеспечивает подтверждение о доставке пакетов.
- **Управление потоком:** Регулирует скорость передачи данных для предотвращения переполнения буфера получателя.
- **Контроль застопора:** Предотвращает перегрузку сети, адаптируя объем передаваемых данных.
- **Упорядочивание:** Гарантирует, что пакеты данных достигают получателя в правильном порядке.

**Пример кода на Python для создания TCP-соединения:**
```python
import socket

# Создание сокета
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# Установление соединения
s.connect(('example.com', 80))

# Отправка данных
s.sendall(b'GET / HTTP/1.1\r\nHost: example.com\r\n\r\n')

# Получение ответа
response = s.recv(4096)

# Закрытие соединения
s.close()
```

- **UDP (User Datagram Protocol):** Это протокол без установления соединения, который передает данные быстрее, но без гарантии доставки.

__UDP__ — это протокол без установления соединения, который не гарантирует доставку данных. Он полезен для случаев, когда скорость передачи данных важнее надежности, например, для потокового видео или онлайн-игр.

**Основные характеристики UDP:**
- **Быстродействие:** UDP минимизирует задержки, не требуя подтверждения о доставке.
- **Простота:** Протокол имеет меньше механизмов управления по сравнению с TCP.
- **Без соединения:** Не требует установления соединения перед передачей данных.

**Пример кода на Python для отправки данных через UDP:**
```python
import socket

# Создание сокета
s = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)

# Отправка данных
s.sendto(b'Сообщение', ('example.com', 12345))

# Закрытие сокета
s.close()
```

##  **IP-адресация:**

__IP-адресация__ — это ключевой элемент сетевых технологий, который позволяет устройствам находить друг друга в сети и обмениваться данными. В основе IP-адресации лежит протокол IP (Internet Protocol), который используется в Интернете для маршрутизации сообщений между устройствами.

- **IPv4:** Использует 32-битные адреса, которые обычно представлены в виде четырех десятичных чисел, разделенных точками.

**Пример IPv4-адреса:**
```
192.168.1.1
```

- **IPv6:** Использует 128-битные адреса для увеличения адресного пространства.


**Пример IPv6-адреса:**
```
2001:0db8:85a3:0000:0000:8a2e:0370:7334
```

### **Динамическая и статическая IP-адресация**

- **Статическая IP-адресация** подразумевает постоянное присвоение IP-адреса устройству.
- **Динамическая IP-адресация** использует протокол DHCP (Dynamic Host Configuration Protocol) для автоматического назначения IP-адресов устройствам.

##  **Маска подсети:**

Маска подсети используется для разделения IP-адреса на сетевую и хостовую части. Например, маска подсети **255.255.255.0** указывает, что первые три октета IP-адреса относятся к сети, а последний октет - к хосту.

__Сетевая маска__ определяет, какая часть IP-адреса относится к сетевому адресу, а какая — к адресу хоста внутри этой сети. Это позволяет организовать адресное пространство на подсети для более эффективного управления трафиком.

**Пример сетевой маски для IPv4:**
```
255.255.255.0
```

##  **NAT (Network Address Translation):**
   NAT позволяет устройствам в локальной сети иметь общий публичный IP-адрес для доступа в Интернет, что увеличивает безопасность и экономит адресное пространство.


### **Пример кода на Python для работы с IP-адресами:**
```python
import socket

# Получение локального IP-адреса
local_ip = socket.gethostbyname(socket.gethostname())

# Вывод IP-адреса
print(f'Локальный IP-адрес: {local_ip}')
```

##  **Протоколы на уровне приложений:**

- **HTTP (Hypertext Transfer Protocol):** Используется для передачи веб-страниц.

__HTTP__ — это основной протокол для передачи данных в Вебе. Он используется для загрузки веб-страниц из сервера на клиентский браузер.

**Основные характеристики HTTP:**
- **Без состояния:** HTTP не сохраняет информацию о состоянии между запросами.
- **Методы запросов:** GET для получения данных, POST для отправки данных, и другие методы, такие как PUT и DELETE.

### **Пример кода на Python для отправки HTTP-запроса:**
```python
import requests

# Отправка GET-запроса
response = requests.get('http://example.com')

# Вывод содержимого ответа
print(response.text)
```

HTTP-запросы и ответы состоят из нескольких компонентов, которые обеспечивают передачу данных между клиентом и сервером. Вот основные элементы:

### HTTP-запрос
HTTP-запрос от клиента к серверу включает в себя:

- **Стартовая строка (Start Line):** Определяет метод запроса, URI ресурса и версию HTTP.
- **Заголовки (Headers):** Содержат метаданные запроса, такие как тип содержимого, куки и параметры кэширования.
- **Пустая строка (Empty Line):** Разделяет заголовки и тело запроса.
- **Тело запроса (Body):** Необязательный компонент, содержит данные, отправляемые на сервер (например, формы или JSON).

### HTTP-ответ
HTTP-ответ от сервера клиенту содержит:

- **Статусная строка (Status Line):** Включает версию HTTP, код состояния и фразу состояния.
- **Заголовки ответа (Response Headers):** Содержат метаданные ответа, такие как тип содержимого и длина содержимого.
- **Пустая строка (Empty Line):** Разделяет заголовки и тело ответа.
- **Тело ответа (Body):** Содержит данные, отправляемые клиенту (например, HTML, JSON).

### Пример HTTP-запроса:
```
GET /index.html HTTP/1.1
Host: www.example.com
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64)
Accept: text/html
Accept-Language: en-US
Accept-Encoding: gzip, deflate
Connection: keep-alive
```

### Пример HTTP-ответа:
```
HTTP/1.1 200 OK
Date: Mon, 23 May 2022 22:38:34 GMT
Server: Apache/2.4.1 (Unix)
Last-Modified: Mon, 23 May 2022 12:33:47 GMT
Content-Type: text/html; charset=UTF-8
Content-Length: 138
Connection: close

<!DOCTYPE html>
<html>
<head>
    <title>Example Page</title>
</head>
<body>
    <h1>Hello, World!</h1>
</body>
</html>
```

---

В заголовке HTTP-запроса может быть включено множество различных полей, которые предоставляют информацию о запросе и его параметрах. Вот некоторые из наиболее часто используемых заголовков запроса:

- **Host:** Доменное имя и порт сервера (если порт не является стандартным).
- **User-Agent:** Информация о клиентском приложении, операционной системе и версии.
- **Accept:** Типы контента, которые клиент готов принять.
- **Accept-Language:** Предпочитаемые языки контента.
- **Accept-Encoding:** Предпочитаемые алгоритмы сжатия (например, gzip).
- **Authorization:** Учетные данные для аутентификации пользователя.
- **Connection:** Управление соединением (например, keep-alive).
- **Content-Length:** Длина тела запроса в байтах (для методов, которые отправляют тело).
- **Content-Type:** Тип данных тела запроса (например, application/json).
- **Cookie:** Куки, которые были установлены сервером в предыдущих ответах.
- **Cache-Control:** Директивы для кэширования ответов.
- **Referer:** URL предыдущего ресурса, с которого был сделан запрос.

Эти заголовки помогают серверу понять, как обрабатывать запрос, какой контент отправить в ответ и какие дополнительные действия могут быть необходимы.

---

- **HTTPS (Hypertext Transfer Protocol Secure):** Добавляет слой шифрования SSL/TLS для безопасности.

__HTTPS__ — это расширение HTTP, которое обеспечивает защищенное соединение с использованием шифрования SSL/TLS.

   - **FTP (File Transfer Protocol):** Используется для передачи файлов.

FTP используется для передачи файлов между клиентом и сервером. Он поддерживает аутентификацию пользователя и предоставляет возможности для работы с файлами и каталогами.

   - **SMTP (Simple Mail Transfer Protocol):** Используется для отправки электронной почты.

__SMTP__ используется для отправки электронной почты. Он работает в сочетании с протоколами POP3 или IMAP, которые используются для получения почты.

##  **Безопасность сети:**
   Включает в себя использование брандмауэров, систем обнаружения вторжений, антивирусного программного обеспечения и политик безопасности для защиты сетевых ресурсов.


## Взаимодействие между веб-сервисами


### REST

__REST__ — это архитектурный стиль, который использует стандартные методы HTTP для обмена данными между системами. 

__RESTful__ веб-сервисы строятся вокруг ресурсов, которые идентифицируются через URI. Клиенты взаимодействуют с этими ресурсами, используя методы HTTP: GET для чтения, POST для создания, PUT для обновления и DELETE для удаления.

**Характеристики REST:**

- **Без состояния:** Каждый запрос от клиента к серверу содержит всю необходимую информацию для его выполнения.
- **Кэширование:** Ответы могут быть кэшированы для улучшения производительности.
- **Единообразие интерфейса:** Стандартизированный способ взаимодействия с ресурсами.

**Преимущества REST:**

- **Масштабируемость:** Легкость в добавлении новых компонентов системы.
- **Простота:** Использует стандартные HTTP-методы и статусы.
- **Гибкость:** Поддерживает различные форматы данных (JSON, XML, YAML и др.).

**Недостатки REST:**

- **Ограниченные методы:** HTTP определяет ограниченное количество операций.
- **Безопасность:** Требует дополнительных мер безопасности, таких как OAuth.

### SOAP
SOAP — это протокол, который определяет, как два объекта в разных процессах могут общаться по сети.

SOAP-сервисы обмениваются сообщениями, которые упакованы в конверты SOAP и могут содержать информацию о вызове функций или методов. Эти сообщения могут быть переданы через различные транспортные протоколы, такие как HTTP, SMTP и др.

**Характеристики SOAP:**

- **Формат сообщений:** SOAP использует XML для форматирования сообщений.
- **WS-Security:** Поддерживает стандарты безопасности для обмена сообщениями.
- **Транспортно-независимый:** Может использовать различные транспортные протоколы.

**Преимущества SOAP:**

- **Стандартизация:** Строгое следование стандартам.
- **Безопасность:** Встроенная поддержка безопасности.
- **Транзакционность:** Поддержка сложных операций и транзакций.

**Недостатки SOAP:**

- **Сложность:** Более тяжеловесный и сложный в реализации.
- **Производительность:** Медленнее из-за использования XML.


## Сокеты

__Сокеты в Python — это низкоуровневый механизм для взаимодействия программ через сеть.__ 

Они позволяют программам устанавливать соединения для обмена данными. Сокеты могут работать как с протоколом TCP, так и с UDP, обеспечивая различные уровни надежности и порядка доставки сообщений.

Вот пример простого TCP-сервера на Python:

```python
import socket

# Создаем сокет
server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# Привязываем сокет к порту
server_socket.bind(('localhost', 12345))

# Переводим сокет в режим прослушивания
server_socket.listen()

print("Сервер запущен и ожидает подключения...")

# Принимаем подключение
client_socket, addr = server_socket.accept()
print(f"Получено подключение от {addr}")

# Получаем данные от клиента
data = client_socket.recv(1024)
print(f"Получены данные: {data.decode('utf-8')}")

# Отправляем данные клиенту
client_socket.sendall("Привет, клиент!".encode('utf-8'))

# Закрываем соединение
client_socket.close()
server_socket.close()
```

Этот код запускает сервер, который слушает входящие подключения на порту 12345. Когда клиент подключается, сервер принимает соединение, получает данные, отправляет ответ и закрывает соединение.

Теперь рассмотрим клиентскую часть:

```python
import socket

# Создаем сокет
client_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

# Подключаемся к серверу
client_socket.connect(('localhost', 12345))

# Отправляем данные
client_socket.sendall("Привет, сервер!".encode('utf-8'))

# Получаем ответ
response = client_socket.recv(1024)
print(f"Ответ сервера: {response.decode('utf-8')}")

# Закрываем соединение
client_socket.close()
```

Клиент подключается к серверу по указанному адресу и порту, отправляет сообщение, получает ответ и закрывает соединение.
