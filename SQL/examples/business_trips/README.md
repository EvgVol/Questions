# Таблица "Командировки", запросы на выборку

В этом уроке на каждом шаге нужно реализовать запросы на выборку для таблицы, в которой представлена информация о командировках сотрудников некоторой организации:

- [Вывести информацию о командировках тех сотрудников, фамилия которых заканчивается на букву «а»](#вывести-информацию-о-командировках-тех-сотрудников-фамилия-которых-заканчивается-на-букву-«а»).
- [Вывести в алфавитном порядке фамилии, имена и отчества тех сотрудников, которые были в командировке в Москве](#вывести-в-алфавитном-порядке-фамилии-имена-и-отчества-тех-сотрудников-которые-были-в-командировке-в-москве).
- [Для каждого города посчитать, сколько раз сотрудники в нем были](#для-каждого-города-посчитать-сколько-раз-сотрудники-в-нем-были).
- [Вывести два города, в которых чаще всего были в командировках сотрудники](#вывести-два-города-в-которых-чаще-всего-были-в-командировках-сотрудники).
- [Вывести информацию о длительности командировок сотрудников](#вывести-информацию-о-длительности-командировок-сотрудников).
- [Вывести информацию о командировках сотрудника(ов), которые были самыми короткими по времени](#вывести-информацию-о-командировках-сотрудникаов-которые-были-самыми-короткими-по-времени).
- [Вывести информацию о командировках, начало и конец которых относятся к одному месяцу](#вывести-информацию-о-командировках-начало-и-конец-которых-относятся-к-одному-месяцу).
- [Вывести номер месяца и количество командировок, первый день которых приходился на этот месяц](#вывести-номер-месяца-и-количество-командировок-первый-день-которых-приходился-на-этот-месяц).
- [Вывести сумму суточных  для командировок сотрудников](#вывести-сумму-суточных-для-командировок-сотрудников).
- [Вывести фамилию с инициалами и общую сумму суточных, полученных за все командировки для тех сотрудников, которые были в командировках больше чем 3 раза](#вывести-фамилию-с-инициалами-и-общую-сумму-суточных-полученных-за-все-командировки-для-тех-сотрудников-которые-были-в-командировках-больше-чем-3-раза).

## Структура и наполнение таблицы

Таблица `trip`, в которой представлена информация о командировках сотрудников некоторой организации (фамилия сотрудника, город, куда он ездил, размер суточных, даты первого и последнего дня командировки) :

|trip_id|name|city|per_diem|date_first|date_last|
|:--- |:--- |:--- |:--- |:--- |:--- |
|__INT__|__PRIMARY KEY__|__AUTO_INCREMENT__|__VARCHAR(30)__|__VARCHAR(25)__|__DECIMAL(8,2)__|__DATЕ__|__DATE__|
|1|Баранов П.Е.|Москва|700|2020-01-12|2020-01-17|
|2|Абрамова К.А.|Владивосток|450|2020-01-14|2020-01-27|
|3|Семенов И.В.|Москва|700|2020-01-23|2020-01-31|
|4|Ильиных Г.Р.|Владивосток|450|2020-01-12|2020-02-02|
|5|Колесов С.П.|Москва|700|2020-02-01|2020-02-06|
|6|Баранов П.Е.|Москва|700|2020-02-14|2020-02-22|
|7|Абрамова К.А.|Москва|700|2020-02-23|2020-03-01|
|8|Лебедев Т.К.|Москва|700|2020-03-03|2020-03-06|
|9|Колесов С.П.|Новосибирск|450|2020-02-27|2020-03-12|
|10|Семенов И.В.|Санкт-Петербург|700|2020-03-29|2020-04-05|
|11|Абрамова К.А.|Москва|700|2020-04-06|2020-04-14|
|12|Баранов П.Е.|Новосибирск|450|2020-04-18|2020-05-04|
|13|Лебедев Т.К.|Томск|450|2020-05-20|2020-05-31|
|14|Семенов И.В.|Санкт-Петербург|700|2020-06-01|2020-06-03|
|15|Абрамова К.А.|Санкт-Петербург|700|2020-05-28|2020-06-04|
|16|Федорова А.Ю.|Новосибирск|450|2020-05-25|2020-06-04|
|17|Колесов С.П.|Новосибирск|450|2020-06-03|2020-06-12|
|18|Федорова А.Ю.|Томск|450|2020-06-20|2020-06-26|
|19|Абрамова К.А.|Владивосток|450|2020-07-02|2020-07-13|
|20|Баранов П.Е.|Воронеж|450|2020-07-19|2020-07-25|


### Вывести информацию о командировках тех сотрудников, фамилия которых заканчивается на букву «а».

Вывести из таблицы trip информацию о командировках тех сотрудников, фамилия которых заканчивается на букву «а», в отсортированном по убыванию даты последнего дня командировки виде. В результат включить столбцы `name`, `city`, `per_diem`, `date_first`, `date_last`.

<hr>

```sql
SELECT name, city, per_diem, date_first, date_last FROM trip
WHERE name LIKE "_%а _%"
ORDER BY date_last DESC;
```
```sql
Query result:
+---------------+-----------------+----------+------------+------------+
| name          | city            | per_diem | date_first | date_last  |
+---------------+-----------------+----------+------------+------------+
| Абрамова К.А. | Владивосток     | 450.00   | 2020-07-02 | 2020-07-13 |
| Федорова А.Ю. | Томск           | 450.00   | 2020-06-20 | 2020-06-26 |
| Абрамова К.А. | Санкт-Петербург | 700.00   | 2020-05-28 | 2020-06-04 |
| Федорова А.Ю. | Новосибирск     | 450.00   | 2020-05-25 | 2020-06-04 |
| Абрамова К.А. | Москва          | 700.00   | 2020-04-06 | 2020-04-14 |
| Абрамова К.А. | Москва          | 700.00   | 2020-02-23 | 2020-03-01 |
| Абрамова К.А. | Владивосток     | 450.00   | 2020-01-14 | 2020-01-27 |
+---------------+-----------------+----------+------------+------------+
```
<hr>

[:arrow_up:Наверх](#таблица-командировки-запросы-на-выборку)

### Вывести в алфавитном порядке фамилии, имена и отчества тех сотрудников, которые были в командировке в Москве.

Вывести в алфавитном порядке фамилии и инициалы тех сотрудников, которые были в командировке в Москве.

<hr>

```sql
SELECT DISTINCT name FROM trip
WHERE city = 'Москва'
ORDER BY name;
```
```sql
Query result:
+---------------+
| name          |
+---------------+
| Абрамова К.А. |
| Баранов П.Е.  |
| Колесов С.П.  |
| Лебедев Т.К.  |
| Семенов И.В.  |
+---------------+
```
<hr>

[:arrow_up:Наверх](#таблица-командировки-запросы-на-выборку)

### Для каждого города посчитать, сколько раз сотрудники в нем были.

Для каждого города посчитать, сколько раз сотрудники в нем были.
Информацию вывести в отсортированном в алфавитном порядке по названию городов.
Вычисляемый столбец назвать `Количество`. 

<hr>

```sql
SELECT DISTINCT city, COUNT(city) AS Количество FROM trip
GROUP BY city
ORDER BY city;
```
```sql
Query result:
+-----------------+------------+
| city            | Количество |
+-----------------+------------+
| Владивосток     | 3          |
| Воронеж         | 1          |
| Москва          | 7          |
| Новосибирск     | 4          |
| Санкт-Петербург | 3          |
| Томск           | 2          |
+-----------------+------------+
```
<hr>

[:arrow_up:Наверх](#таблица-командировки-запросы-на-выборку)

### Вывести два города, в которых чаще всего были в командировках сотрудники.

Вывести два города, в которых чаще всего были в командировках сотрудники.
Вычисляемый столбец назвать `Количество`.

<hr>

```sql
SELECT city, (COUNT(city)) AS Количество FROM trip
GROUP BY city 
ORDER BY Количество DESC
LIMIT 2;
```
```sql
Query result:
+-------------+------------+
| city        | Количество |
+-------------+------------+
| Москва      | 7          |
| Новосибирск | 4          |
+-------------+------------+
```
<hr>

[:arrow_up:Наверх](#таблица-командировки-запросы-на-выборку)

### Вывести информацию о длительности командировок сотрудников.

Вывести информацию о командировках во все города кроме Москвы и Санкт-Петербурга (фамилии и инициалы сотрудников, город, длительность командировки в днях, при этом первый и последний день относится к периоду командировки). Последний столбец назвать Длительность. Информацию вывести в упорядоченном по убыванию длительности поездки, а потом по убыванию названий городов (в обратном алфавитном порядке).

Для вычитания двух дат используется функция `DATEDIFF(дата_1, дата_2)`, результатом которой является количество дней между `дата_1` и `дата_2`. Например,

```sql
DATEDIFF('2020-04-01', '2020-03-28')=4

DATEDIFF('2020-05-09','2020-05-01')=8

DATEDIFF(date_last, date_first)
```

<hr>

```sql
SELECT name, city, (DATEDIFF(date_last, date_first) + 1) AS Длительность FROM trip
WHERE city NOT IN ('Москва', 'Санкт-Петербург')
ORDER BY Длительность DESC, city DESC;
```
```sql
Query result:
+---------------+-------------+--------------+
| name          | city        | Длительность |
+---------------+-------------+--------------+
| Ильиных Г.Р.  | Владивосток | 22           |
| Баранов П.Е.  | Новосибирск | 17           |
| Колесов С.П.  | Новосибирск | 15           |
| Абрамова К.А. | Владивосток | 14           |
| Лебедев Т.К.  | Томск       | 12           |
| Абрамова К.А. | Владивосток | 12           |
| Федорова А.Ю. | Новосибирск | 11           |
| Колесов С.П.  | Новосибирск | 10           |
| Федорова А.Ю. | Томск       | 7            |
| Баранов П.Е.  | Воронеж     | 7            |
+---------------+-------------+--------------+
```
<hr>

[:arrow_up:Наверх](#таблица-командировки-запросы-на-выборку)

### Вывести информацию о командировках сотрудника(ов), которые были самыми короткими по времени.

Вывести информацию о командировках сотрудника(ов), которые были самыми короткими по времени.
В результат включить столбцы `name`, `city`, `date_first`, `date_last`.

<hr>

```sql
SELECT name, city, date_first, date_last FROM trip
WHERE DATEDIFF(date_last, date_first) = (
    SELECT MIN(DATEDIFF(date_last, date_first)) FROM trip
)

```
```sql
Query result:
+--------------+-----------------+------------+------------+
| name         | city            | date_first | date_last  |
+--------------+-----------------+------------+------------+
| Семенов И.В. | Санкт-Петербург | 2020-06-01 | 2020-06-03 |
+--------------+-----------------+------------+------------+
```
<hr>

[:arrow_up:Наверх](#таблица-командировки-запросы-на-выборку)

### Вывести информацию о командировках, начало и конец которых относятся к одному месяцу.

Вывести информацию о командировках, начало и конец которых относятся к одному месяцу (год может быть любой). 
В результат включить столбцы `name`, `city`, `date_first`, `date_last`.
Строки отсортировать сначала в алфавитном порядке по названию города, а затем по фамилии сотрудника.

Для того, чтобы выделить номер месяца из даты используется функция `MONTH(дата)`.

Например, `MONTH('2020-04-12') = 4`.

Если определяется месяц для  значений столбца `date_first`, то используется запись `MONTH(date_first)`

<hr>

```sql
SELECT name, city, date_first, date_last FROM trip
WHERE MONTH(date_first) = MONTH(date_last) 
ORDER BY city, name;

```
```sql
Query result:
+---------------+-----------------+------------+------------+
| name          | city            | date_first | date_last  |
+---------------+-----------------+------------+------------+
| Абрамова К.А. | Владивосток     | 2020-01-14 | 2020-01-27 |
| Абрамова К.А. | Владивосток     | 2020-07-02 | 2020-07-13 |
| Баранов П.Е.  | Воронеж         | 2020-07-19 | 2020-07-25 |
| Абрамова К.А. | Москва          | 2020-04-06 | 2020-04-14 |
| Баранов П.Е.  | Москва          | 2020-01-12 | 2020-01-17 |
| Баранов П.Е.  | Москва          | 2020-02-14 | 2020-02-22 |
| Колесов С.П.  | Москва          | 2020-02-01 | 2020-02-06 |
| Лебедев Т.К.  | Москва          | 2020-03-03 | 2020-03-06 |
| Семенов И.В.  | Москва          | 2020-01-23 | 2020-01-31 |
| Колесов С.П.  | Новосибирск     | 2020-06-03 | 2020-06-12 |
| Семенов И.В.  | Санкт-Петербург | 2020-06-01 | 2020-06-03 |
| Лебедев Т.К.  | Томск           | 2020-05-20 | 2020-05-31 |
| Федорова А.Ю. | Томск           | 2020-06-20 | 2020-06-26 |
+---------------+-----------------+------------+------------+
```
<hr>

[:arrow_up:Наверх](#таблица-командировки-запросы-на-выборку)

### Вывести номер месяца и количество командировок, первый день которых приходился на этот месяц.

Вывести название месяца и количество командировок для каждого месяца. Считаем, что командировка относится к некоторому месяцу, если она началась в этом месяце.
Информацию вывести сначала в отсортированном по убыванию количества, а потом в алфавитном порядке по названию месяца виде. Название столбцов – `Месяц` и `Количество`.

Немного теории

Для того, чтобы выделить название месяца из даты используется функция `MONTHNAME(дата)`, которая возвращает название месяца на английском языке для указанной даты. 
Например, `MONTHNAME('2020-04-12')='April'`.
Если группировка осуществляется по вычисляемому столбцу (в данном случае «вычисляется» название месяца), то после `GROUP BY` можно указать как вычисляемое выражение, так и имя столбца, заданное с помощью `AS`. Важно отметить, что последний вариант (указать имя столбца) нарушает стандарт по порядку выполнения запросов, но иногда может встречаться на реальных платформах.


<hr>

```sql
SELECT DISTINCT(MONTHNAME(date_first)) AS Месяц,
    (COUNT(MONTHNAME(date_first))) AS Количество
FROM trip
GROUP BY MONTHNAME(date_first)
ORDER BY Количество DESC, Месяц
```
```sql
Query result:
+----------+------------+
| Месяц    | Количество |
+----------+------------+
| February | 4          |
| January  | 4          |
| June     | 3          |
| May      | 3          |
| April    | 2          |
| July     | 2          |
| March    | 2          |
+----------+------------+
```
<hr>

[:arrow_up:Наверх](#таблица-командировки-запросы-на-выборку)

### Вывести сумму суточных  для командировок сотрудников.

Вывести сумму суточных (произведение количества дней командировки и размера суточных) для командировок, первый день которых пришелся на февраль или март 2020 года. Значение суточных для каждой командировки занесено в столбец per_diem. Вывести фамилию и инициалы сотрудника, город, первый день командировки и сумму суточных. Последний столбец назвать Сумма. Информацию отсортировать сначала  в алфавитном порядке по фамилиям сотрудников, а затем по убыванию суммы суточных.

<hr>

```sql
SELECT name, city, date_first, (
    (DATEDIFF(date_last, date_first) + 1) * per_diem
) AS Сумма FROM trip
WHERE MONTH(date_first) IN (2, 3) AND YEAR(date_first) = 2020
ORDER BY name, Сумма DESC;

```
```sql
Query result:
+---------------+-----------------+------------+---------+
| name          | city            | date_first | Сумма   |
+---------------+-----------------+------------+---------+
| Абрамова К.А. | Москва          | 2020-02-23 | 5600.00 |
| Баранов П.Е.  | Москва          | 2020-02-14 | 6300.00 |
| Колесов С.П.  | Новосибирск     | 2020-02-27 | 6750.00 |
| Колесов С.П.  | Москва          | 2020-02-01 | 4200.00 |
| Лебедев Т.К.  | Москва          | 2020-03-03 | 2800.00 |
| Семенов И.В.  | Санкт-Петербург | 2020-03-29 | 5600.00 |
+---------------+-----------------+------------+---------+
```
<hr>

[:arrow_up:Наверх](#таблица-командировки-запросы-на-выборку)

### Вывести фамилию с инициалами и общую сумму суточных, полученных за все командировки для тех сотрудников, которые были в командировках больше чем 3 раза.

Вывести фамилию с инициалами и общую сумму суточных, полученных за все командировки для тех сотрудников, которые были в командировках больше чем 3 раза, в отсортированном по убыванию сумм суточных виде. Последний столбец назвать `Сумма`.

Только для этого задания изменена строка таблицы `trip`:

|trip_id|name|city|per_diem|date_first|date_last|
|:--- |:--- |:--- |:--- |:--- |:--- |
|4|Ильиных Г.Р.|Владивосток|450|2020-01-12|__2020-03-02__|


<hr>

```sql
SELECT DISTINCT name,
    (SUM((DATEDIFF(date_last, date_first) + 1) * per_diem)
) AS Сумма
FROM trip
GROUP BY name
HAVING COUNT(name) > 3
ORDER BY Сумма DESC;
```
```sql
Query result:
+---------------+----------+
| name          | Сумма    |
+---------------+----------+
| Абрамова К.А. | 29200.00 |
| Баранов П.Е.  | 21300.00 |
+---------------+----------+
```
<hr>

[:arrow_up:Наверх](#таблица-командировки-запросы-на-выборку)
