# SQL (Structured Query Language)

* SQL - это декларативный язык программирования (язык запросов), который используют для создания, обработки и хранения данных в реляционных базах данных.

Реляционная модель была разработана в конце 1960-х годов Е.Ф.Коддом.
Она определяет способ представления данных (структуру данных), методы защиты данных (целостность данных), и операции, которые можно выполнять с данными (манипулирование данными).

Эта модель лежит в основе всех реляционных баз данных до настоящего времени.

## Основные принципы реляционных баз данных:

- все данные на концептуальном уровне представляются в виде объектов, заданных в виде строк и столбцов, называемых отношением, более распространенное название – таблица;
- в пересечение строки и столбца таблицы можно занести только одно значение;
- все операции выполняются над целыми отношениями и результатом этих операций является отношение.


## Терминология реляционных баз данных:

* отношение  – это структура данных целиком, набор записей (в обычном понимании – таблица);

* кортеж – это каждая строка , содержащая данные (более распространенный термин – запись ), например, <001, Борин С.А, 234-01-23, программист>, все кортежи в отношении должны быть различны;

* мощность – число кортежей в таблице (проще говоря, число записей), в данном случае 3, мощность отношения может быть любой (от 0 до бесконечности), порядок следования кортежей - неважен;

* атрибут – это столбец в таблице (более распространенный термин – поле);

* размерность – это число атрибутов в таблице;
размерность отношения должна быть больше 0, порядок следования атрибутов существенен;

* домен атрибута – это допустимые значения (неповторяющиеся), которые можно занести в поле , например для атрибута Должность домен – {инженер, программист}.

## Отношение, реляционная модель

База данных, в том числе и реляционная, используется для формального описания некоторой предметной области реального мира, например, склада, учебного процесса и пр. Обязательным этапом перед созданием базы данных является ее проектирование.

Перед созданием таблицы в базе данных необходимо описать ее структуру. Для этого выполняется следующая последовательность шагов:

1. Дать таблице имя, пусть она будет называться `book`, вот некоторые правила для выбора имен таблиц:

- может включать английские буквы, цифры и знак подчеркивания, должно начинаться с буквы;
- имя должно быть уникальным в пределах базы данных.

Также рекомендуется:

- чтобы имя было существительным в единственном числе;
- имя должно быть понятным и соответствовать тому объекту, который оно описывает;
- имя должно быть как можно короче, максимум до 10 символов.

2. Определить структуру таблицы, из каких атрибутов(столбцов, полей) она будет состоять.

Правила по выбору имени поля информационного объекта:

- может включать английские буквы, цифры и знак подчеркивания, должно начинаться с буквы;
- имя поля должно быть уникальным в пределах таблицы.

Рекомендации по выбору имени поля информационного объекта:

- имя должно быть понятным и соответствовать тем данным, которые хранятся в поле;
- имя может состоять из нескольких слов, тогда слова разделяются подчеркиванием, после подчеркивания слово пишется с маленькой буквы.

3. Включить ключевое поле `book_id`, которое является `ОБЯЗАТЕЛЬНЫМ ЭЛЕМЕНТОМ` каждой реляционной таблицы. 
Ключевое поле является уникальным для каждой записи, однозначно определяет запись и в дальнейшем будет использоваться для связей с другими таблицами.

Рекомендации по именованию  ключевых полей:

- имя должно состоять из двух частей: начинаться с названия таблицы, которой поле принадлежит, затем через подчеркивание необходимо указать `id`.

## Выбор типов данных для полей 

После описания структуры таблицы необходимо выбрать типы данных для каждого поля.

### Основные типы данных SQL:

| Тип данных        | Описание                                       | Пример                            |
| :-----------------| :--------------------------------------------  | :-------------------------------- |
| INT (INTEGER)     | Целое число от -2 147 483 648 до 2 147 483 647 | -5671205                          |
| DECIMAL (NUMERIC) | Вещественное число                             | -3.294                            |
| DATE              | Дата                                           |                                   |
| VARCHAR           |                                                |                                   |


... (пропущено)

## Выборка данных, вычисляемые столбцы, математические функции

| Функция           | Описание                                                | Пример                              |
| :-----------------| :--------------------------------------------           | :--------------------------------   |
| CEILING(x)        | возвращает наименьшее целое число, большее или равное x | CEILING(4.2)=5 CEILING(-5.8)=-5     |
| ROUND(x, k)       | округляет значение x до k знаков после запятой          | ROUND(4.361)=4 ROUND(5.86592,1)=5.9 |
| FLOOR(x)          | возвращает наибольшее целое число, меньшее или равное x | FLOOR(4.2)=4 FLOOR(-5.8)=-6         |
| POWER(x, y)       | возведение x в степень y                                | POWER(3,4)=81.0                     |
| SQRT(x)           | квадратный корень из x                                  | SQRT(4)=2.0 SQRT(2)=1.41...         |
| DEGREES(x)        | конвертирует значение x из радиан в градусы             | DEGREES(3) = 171.8...               |
| RADIANS(x)        | конвертирует значение x из градусов в радианы           | RADIANS(180)=3.14...                |
| ABS(x)            | модуль числа x                                          | ABS(-1) = 1  ABS(1) = 1             |
| PI()              | pi = 3.1415926...                                       |                                     |

## Выборка данных, вычисляемые столбцы, логические функции

В SQL реализована возможность заносить в поле значение в зависимости от условия. Для этого используется функция `IF()`:

```bash
IF(логическое_выражение, выражение_1, выражение_2)
```

Функция вычисляет логическое_выражение, если оно истина – в поле заносится значение выражения_1, в противном случае –  значение выражения_2.
Все три параметра `IF()` являются `обязательными`.

Допускается использование вложенных функций, вместо выражения_1 или выражения_2 может стоять новая функция `IF`.

<hr>

*ПРИМЕР:*
*При анализе продаж книг выяснилось, что наибольшей популярностью пользуются книги Михаила Булгакова, на втором месте книги Сергея Есенина. Исходя из этого решили поднять цену книг Булгакова на 10%, а цену книг Есенина - на 5%. Написать запрос, куда включить автора, название книги и новую цену, последний столбец назвать new_price. Значение округлить до двух знаков после запятой.*

```sql
SELECT author, title,
    ROUND(IF(author = 'Булгаков М.А.', price * 1.10, IF(author = 'Есенин С.А.', price * 1.05, price)), 2) AS new_price 
FROM book;
```
```sql
Query result:
+------------------+-----------------------+-----------+
| author           | title                 | new_price |
+------------------+-----------------------+-----------+
| Булгаков М.А.    | Мастер и Маргарита    | 738.09    |
| Булгаков М.А.    | Белая гвардия         | 594.55    |
| Достоевский Ф.М. | Идиот                 | 460.00    |
| Достоевский Ф.М. | Братья Карамазовы     | 799.01    |
| Есенин С.А.      | Стихотворения и поэмы | 682.50    |
+------------------+-----------------------+-----------+
```
<hr>

## Выборка данных по условию

С помощью запросов можно включать в итоговую выборку не все строки исходной таблицы, а только те, которые отвечают некоторому условию.

Для этого после указания таблицы, откуда выбираются данные, задается ключевое слово `WHERE` и логическое выражение, от результата которого зависит будет ли включена строка в выборку или нет. 

Если условие – истина, то строка(запись)  включается в выборку, если ложь – нет.

<hr>

*ПРИМЕР:*
*Вывести название и цену тех книг, цены которых меньше 600 рублей.*

```sql
SELECT title, price FROM book WHERE price < 600;
```
```sql
+---------------+--------+
| title         | price  |
+---------------+--------+
| Белая гвардия | 540.50 |
| Идиот         | 460.00 |
+---------------+--------+
```
<hr>
